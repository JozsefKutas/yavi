<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Validating arguments</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="validating-arguments">Validating arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>YAVI supports validating arguments of a constructor or factory method <strong>before creating an object</strong> with Arguments Validator.</p>
</div>
<div class="paragraph">
<p>This is one of YAVI&#8217;s unique features.</p>
</div>
<div class="sect2">
<h3 id="_define_and_obtain_an_arguments_validator_instance">Define and obtain an Arguments Validator instance</h3>
<div class="paragraph">
<p>Arguments Validator, as the name implies, is a Validator for arguments.</p>
</div>
<div class="paragraph">
<p>A normal Validator, like Bean Validation, validates if the values are valid for the object to which the values are set, while the Arguments Validator validates that <strong>the arguments</strong> set to the Object are valid.</p>
</div>
<div class="paragraph">
<p>Since an Object is created before validation in a normal Validator, there is a possibility of creating an Object in an incomplete state temporarily.
For example, even if the constraint of <code>notNull()</code> is imposed on the Validator side,
if the <code>null</code> check is implemented in the constructor, this <code>null</code> check will work before the validation by Validator is executed.</p>
</div>
<div class="paragraph">
<p>The Arguments Validator creates an Object after validation, so you don&#8217;t have to worry about an incomplete Object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {
    public Person(String name, String email, Integer age) {
        // ...
    }

    public static Arguments3Validator&lt;String, String, Integer, Person&gt; validator = ArgumentsValidatorBuilder
        .of(Person::new)
        .builder(b -&gt; b
            ._string(Arguments1::arg1, "name", c -&gt; c.notBlank().lessThanOrEqual(100)) // Constrains onf the first argument of Person::new
            ._string(Arguments2::arg2, "email", c -&gt; c.notBlank().lessThanOrEqual(100).email()) // Constrains onf the second argument of Person::new
            ._integer(Arguments3::arg3, "age", c -&gt; c.greaterThanOrEqual(0).lessThan(200))) // Constrains onf the third argument of Person::new
        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Arguments Validator can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validated&lt;Person&gt; personValidated = Person.validator.validate("Jone Doe", "jdoe@example.com", 30);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>am.ik.yavi.arguments.Arguments1Validator</code> to <code>am.ik.yavi.arguments.Arguments16Validator</code> are available.</p>
</div>
<div class="paragraph">
<p>Arguments Validator is useful, but it can be a bit verbose to define. Since it is Type-Safe, it is not possible to define something that does not fit the type, but it feels like a puzzle that fits the type.
Building the Arguments Validator can be simplified by "<a href="#define-validator-for-a-single-value">Define Validator for a single value</a>" and "<a href="#combining-validators">[combining-validators]</a>".</p>
</div>
</div>
<div class="sect2">
<h3 id="_validating_method_arguments">Validating method arguments</h3>
<div class="paragraph">
<p>Arguments Validator can be used for validating method arguments as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// From https://beanvalidation.org/
public class UserService {
    public User createUser(/* @Email */ String email,
                         /* @NotNull */ String name) {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The arguments for <code>UserService.createUser</code> in the above example can be validated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments3Validator&lt;UserService, String, String, User&gt; validator = ArgumentsValidatorBuilder
    .of(UserService::createUser)
    .builder(b -&gt; b
        ._object(Arguments1::arg1, "userService", c -&gt; c.notNull())
        ._string(Arguments2::arg2, "email", c -&gt; c.email())
        ._string(Arguments3::arg3, "name", c -&gt; c.notNull()))
    .build();

UserService userService = new UserService();
Validated&lt;User&gt; userValidated = validator.validate(userService, "jdoe@example.com", "John Doe");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>void</code> cannot be used as return type while <code>java.lang.Void</code> is available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="define-validator-for-a-single-value">Define Validator for a single value</h3>
<div class="paragraph">
<p>If you just want to define <code>Arguments1Validator</code> for a single <code>String</code> or <code>Integer</code> etc, you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">StringValidator&lt;String&gt; nameValidator = StringValidatorBuilder
    .of("name", c -&gt; c.notBlank().lessThanOrEqual(100))
    .build();  // -&gt; extends Arguments1Validator&lt;String, String&gt;

StringValidator&lt;String&gt; emailValidator = StringValidatorBuilder
    .of("email", c -&gt; c.notBlank().lessThanOrEqual(100).email())
    .build();  // -&gt; extends Arguments1Validator&lt;String, String&gt;

IntegerValidator&lt;Integer&gt; ageValidator = IntegerValidatorBuilder
    .of("age", c -&gt; c.greaterThanOrEqual(0).lessThan(200))
    .build();  // -&gt; extends Arguments1Validator&lt;Integer, Integer&gt;

Validated&lt;String&gt; nameValidated = nameValidator.validate("Jone Doe");
Validated&lt;String&gt; emailValidated = nameValidator.validate("jdoe@example.com");
Validated&lt;Integer&gt; ageValidated = nameValidator.validate(30);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can convert it to a Value Object after validation by using the <code>andThen</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">StringValidator&lt;Name&gt; nameValidator = StringValidatorBuilder
    .of("name", c -&gt; c.notBlank().lessThanOrEqual(100))
    .build()
    .andThen(name -&gt; new Name(name)); // -&gt; extends Arguments1Validator&lt;String, Name&gt;

StringValidator&lt;Email&gt; emailValidator = StringValidatorBuilder
    .of("email", c -&gt; c.notBlank().lessThanOrEqual(100).email())
    .build()
    .andThen(email -&gt; new Email(email)); // -&gt; extends Arguments1Validator&lt;String, Email&gt;

IntegerValidator&lt;Age&gt; ageValidator = IntegerValidatorBuilder
    .of("age", c -&gt; c.greaterThanOrEqual(0).lessThan(200))
    .build()
    .andThen(age -&gt; new Age(age)); // -&gt; extends Arguments1Validator&lt;Integer, Age&gt;

Validated&lt;Name&gt; nameValidated = nameValidator.validate("Jone Doe");
Validated&lt;Email&gt; emailValidated = nameValidator.validate("jdoe@example.com");
Validated&lt;Age&gt; ageValidated = nameValidator.validate(30);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to create an <code>Arguments1Validator</code> for a <code>List</code>, you can "lift" a <code>Validator</code> for the element of the list as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments1Validator&lt;Iterable&lt;String&gt;, List&lt;Email&gt;&gt; emailsValidator = ArgumentsValidators.liftList(emailValidator);
Validated&lt;List&lt;Email&gt;&gt; emailsValidated = emailsValidator.validate(List.of("foo@example.com", "bar@example.com"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>These "small Validators" can be very powerful parts by using the Validator combinators described in "<a href="#combining-validators">[combining-validators]</a>".</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-06-15 08:47:27 UTC
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>