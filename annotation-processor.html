<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Annotation Processor</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="annotation-processor">Annotation Processor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>YAVI provides Annotation Processor to generates classes which defines meta classes
that implement <code>am.ik.yavi.meta.ConstraintMeta</code> for each target which is annotated with <code>am.ik.yavi.meta.ConstraintTarget</code> or <code>am.ik.yavi.meta.ConstraintArguments</code>.</p>
</div>
<div class="paragraph">
<p>When you have a class as following, run <code>mvn clean compile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintTarget;

public class UserForm {

    private String name;

    private String email;

    private Integer age;

    @ConstraintTarget
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @ConstraintTarget
    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @ConstraintTarget
    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see <code>target/generated-sources/annotations/com/example/_UserFormMeta.java</code> is automatically generated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@ConstraintTarget</code> and <code>@ConstraintArguments</code> are compile-time annotations, so they disappear at runtime.
+ This won&#8217;t break YAVI&#8217;s "No annotation!" concept ;)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_annotating_constrainttarget">Annotating <code>@ConstraintTarget</code></h3>
<div class="paragraph">
<p><code>@ConstraintTarget</code> is used to generate meta classes that can be used with <code>ValidatorBuilder#constraint</code>.
+ It can be annotated on methods or constructor arguments.</p>
</div>
<div class="paragraph">
<p><code>Xyz</code> class that is annotated with <code>@ConstraintTarget</code> will generate <code>_XyzMeta</code>.</p>
</div>
<div class="paragraph">
<p><code>Validator</code> can be built as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;UserForm&gt; validator = ValidatorBuilder.&lt;UserForm&gt; of()
    .constraint(_UserFormMeta.NAME, c -&gt; c.notEmpty())
    .constraint(_UserFormMeta.EMAIL, c -&gt; c.notEmpty().email())
    .constraint(_UserFormMeta.AGE, c -&gt; c.greaterThan(0))
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>No more string literal is required and it&#8217;s really type-safe.</p>
</div>
<div class="paragraph">
<p>The example above is available for the following 4 ways of generation.</p>
</div>
<div class="sect3">
<h4 id="_constrainttarget_on_getters"><code>@ConstraintTarget</code> on getters</h4>
<div class="paragraph">
<p>If you like "Java Beans" style, this way would be straightforward.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintTarget;

public class UserForm {

    private String name;

    private String email;

    private Integer age;

    @ConstraintTarget
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @ConstraintTarget
    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @ConstraintTarget
    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T17:37:47.866300+09:00
public class _UserFormMeta {

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::getName;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::getEmail;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.Integer&gt; toValue() {
            return com.example.UserForm::getAge;
        }
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_on_constructor_arguments_getters">on constructor arguments + getters</h4>
<div class="paragraph">
<p>If you prefer an immutable class like Value Object, annotate <code>@ConstraintTarget</code> on constructor arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintTarget;

public class UserForm {

    private final String name;

    private final String email;

    private final Integer age;

    public UserForm(@ConstraintTarget String name,
                    @ConstraintTarget String email,
                    @ConstraintTarget Integer age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }


    public String getName() {
        return name;
    }

    public String getEmail() {
        return email;
    }

    public Integer getAge() {
        return age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T17:59:03.892823+09:00
public class _UserFormMeta {

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::getName;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::getEmail;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.Integer&gt; toValue() {
            return com.example.UserForm::getAge;
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is as same as the first example.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_constructor_arguments_non_getters">on constructor arguments + non-getters</h4>
<div class="paragraph">
<p>You may not like "getter" style for immutable objects.
You can use filed name as method name using <code>getter = false</code>. This will be a great fit for <a href="https://openjdk.java.net/jeps/395">Records</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintTarget;

public class UserForm {

    private final String name;

    private final String email;

    private final Integer age;

    public UserForm(@ConstraintTarget(getter = false) String name,
                    @ConstraintTarget(getter = false) String email,
                    @ConstraintTarget(getter = false) Integer age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }


    public String name() {
        return name;
    }

    public String email() {
        return email;
    }

    public Integer age() {
        return age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T18:00:37.868495+09:00
public class _UserFormMeta {

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::name;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return com.example.UserForm::email;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.Integer&gt; toValue() {
            return com.example.UserForm::age;
        }
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_on_constructor_arguments_field_access">on constructor arguments + field access</h4>
<div class="paragraph">
<p>You may prefer accessing fields directly rather than accessors, then use <code>field = true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintTarget;

public class UserForm {

    final String name;

    final String email;

    final Integer age;

    public UserForm(@ConstraintTarget(field = true) String name,
                    @ConstraintTarget(field = true) String email,
                    @ConstraintTarget(field = true) Integer age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T18:02:47.124191+09:00
public class _UserFormMeta {

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return x  -&gt; x.name;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.String&gt; toValue() {
            return x  -&gt; x.email;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;com.example.UserForm&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;com.example.UserForm, java.lang.Integer&gt; toValue() {
            return x  -&gt; x.age;
        }
    };
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_annotating_constraintarguments">Annotating <code>@ConstraintArguments</code></h3>
<div class="paragraph">
<p><code>@ConstraintArguments</code> is used to generate meta classes that can be used with <code>ArgumentsValidatorBuilder</code>.
+ It can be annotated on constructors or methods.</p>
</div>
<div class="paragraph">
<p>The constructor of <code>Xyz</code> class that is annotated with <code>@ConstraintTarget</code> will generate <code>_XyzArgumentsMeta</code>.</p>
</div>
<div class="paragraph">
<p><code>doSomething</code> method of <code>Xyz</code> class that is annotated with <code>@ConstraintTarget</code> will generate <code>_XyzDoSomethingArgumentsMeta</code>.</p>
</div>
<div class="sect3">
<h4 id="_validating_constructor_arguments">Validating Constructor Arguments</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintArguments;

public class User {

    private final String name;

    private final String email;

    private final int age;

    @ConstraintArguments
    public User(String name, String email, int age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T18:22:15.164882+09:00
public class _UserArgumentsMeta {

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.String&gt; toValue() {
            return am.ik.yavi.arguments.Arguments1::arg1;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.String&gt; toValue() {
            return am.ik.yavi.arguments.Arguments2::arg2;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments3&lt;java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.Integer&gt; toValue() {
            return am.ik.yavi.arguments.Arguments3::arg3;
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ArgumentsNValidator</code> can be built as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments3Validator&lt;String, String, Integer, User&gt; validator = ArgumentsValidatorBuilder
    .of(User::new)
    .builder(b -&gt; b
        .constraint(_UserArgumentsMeta.NAME, c -&gt; c.notEmpty())
        .constraint(_UserArgumentsMeta.EMAIL, c -&gt; c.notEmpty().email())
        .constraint(_UserArgumentsMeta.AGE, c -&gt; c.greaterThan(0))
    )
    .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_method_arguments">Validating Method Arguments</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

import am.ik.yavi.meta.ConstraintArguments;

public class UserService {

    @ConstraintArguments
    public User createUser(String name, String email, int age) {
        return new User(name, email, age);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will generate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.example;

// Generated at 2020-02-11T18:40:53.554587+09:00
public class _UserServiceCreateUserArgumentsMeta {

    public static final am.ik.yavi.meta.ObjectConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, com.example.UserService&gt; USERSERVICE = new am.ik.yavi.meta.ObjectConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, com.example.UserService&gt;() {

        @Override
        public String name() {
            return "userService";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, com.example.UserService&gt; toValue() {
            return am.ik.yavi.arguments.Arguments1::arg1;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; NAME = new am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "name";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.String&gt; toValue() {
            return am.ik.yavi.arguments.Arguments2::arg2;
        }
    };

    public static final am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; EMAIL = new am.ik.yavi.meta.StringConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "email";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.String&gt; toValue() {
            return am.ik.yavi.arguments.Arguments3::arg3;
        }
    };

    public static final am.ik.yavi.meta.IntegerConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt; AGE = new am.ik.yavi.meta.IntegerConstraintMeta&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;&gt;() {

        @Override
        public String name() {
            return "age";
        }

        @Override
        public java.util.function.Function&lt;am.ik.yavi.arguments.Arguments4&lt;com.example.UserService, java.lang.String, java.lang.String, java.lang.Integer&gt;, java.lang.Integer&gt; toValue() {
            return am.ik.yavi.arguments.Arguments4::arg4;
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ArgumentsNValidator</code> can be built as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments4Validator&lt;UserService, String, String, Integer, User&gt; validator = ArgumentsValidatorBuilder
    .of(UserService::createUser)
    .builder(b -&gt; b
        .constraint(_UserServiceCreateUserArgumentsMeta.USERSERVICE, c -&gt; c.notNull())
        .constraint(_UserServiceCreateUserArgumentsMeta.NAME, c -&gt; c.notEmpty())
        .constraint(_UserServiceCreateUserArgumentsMeta.EMAIL, c -&gt; c.notEmpty().email())
        .constraint(_UserServiceCreateUserArgumentsMeta.AGE, c -&gt; c.greaterThan(0))
    )
    .build();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-10-14 15:34:33 UTC
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>