<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Core Features</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="core-features">Core Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_define_and_obtain_a_core_validator_instance">Define and obtain a core <code>Validator</code> instance</h3>
<div class="paragraph">
<p>The core validator <code>am.ik.yavi.core.Validator</code> can be defined and obtained via <code>am.ik.yavi.builder.ValidatorBuilder</code>.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;User&gt; validator = ValidatorBuilder.&lt;User&gt; of() // or ValidatorBuilder.of(User.class)
    .constraint(User::getName, "name", c -&gt; c.notNull().lessThanOrEqual(20))
    .constraint(User::getEmail, "email", c -&gt; c.notNull().greaterThanOrEqual(5).lessThanOrEqual(50).email())
    .constraint(User::getAge, "age", c -&gt; c.notNull().greaterThanOrEqual(0).lessThanOrEqual(200))
    .build();

ConstraintViolations violations = validator.validate(user);
violations.isValid(); // true or false
violations.forEach(x -&gt; System.out.println(x.message()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to avoid ambiguous type inferences, you can use explicit <code>_&lt;type&gt;</code> method per type instead of constraint as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;User&gt; validator = ValidatorBuilder.&lt;User&gt; of()
    ._string(User::getName, "name", c -&gt; c.notNull().lessThanOrEqual(20))
    ._string(User::getEmail, "email", c -&gt; c.notNull().greaterThanOrEqual(5).lessThanOrEqual(50).email())
    ._integer(User::getAge, "age", c -&gt; c.notNull().greaterThanOrEqual(0).lessThanOrEqual(200))
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of the <code>constraint</code> method does not have to be a "Getter" as long as it is a <code>java.util.function.Function</code>.</p>
</div>
<div class="paragraph">
<p>For example,ã€€If you want to create a <code>Validator</code> for <a href="https://openjdk.java.net/jeps/395">Records</a>, you can implement it straightforwardly like bellow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public record User(String name, String email, int age) {
}

Validator&lt;User&gt; validator = ValidatorBuilder.&lt;User&gt; of() // or ValidatorBuilder.of(User.class)
    .constraint(User::name, "name", c -&gt; c.notNull().lessThanOrEqual(20))
    // ...
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if you don&#8217;t want your method to expose the target field, you can define it like follwing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class User {
	private final String name;

	public final Validator&lt;User&gt; validator = ValidatorBuilder.&lt;User&gt;of()
			._string(x -&gt; x.name, "name", c -&gt; c.notNull().lessThanOrEqual(20))
			.build();

	public User(String name) {
		this.name = name;
	}

	// Omits others
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#built-in-constraints">[built-in-constraints]</a> for other constraint rules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_constraints_on_nested_objects">Constraints on nested objects</h3>
<div class="paragraph">
<p>You can use <code>nested</code> method to apply constraints to the nested fields.
You can delegate to the <code>Validator</code> for the nested field, or you can also define a set of constraints on the nested field inside.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Address {
    private Country country;
    private City city;
    // Omits other fields and getters
}

Validator&lt;Country&gt; countryValidator = ValidatorBuilder.&lt;Country&gt; of()
    .nest(Country::getName, "name", c -&gt; c.notBlank().lessThanOrEqual(20))
    .build();
Validator&lt;City&gt; cityValidator = ValidatorBuilder.&lt;City&gt; of()
    .nest(City::getName, "name", c -&gt; c.notBlank().lessThanOrEqual(100))
    .build();

Validator&lt;Address&gt; validator = ValidatorBuilder.&lt;Address&gt; of()
    .nest(Address::getCountry, "country", countryValidator)
    .nest(Address::getCity, "city", cityValidator)
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;Address&gt; validator = ValidatorBuilder.&lt;Address&gt; of()
      .nest(Address::getCountry, "country",
            b -&gt; b.constraint(Country::getName, "name", c -&gt; c.notBlank().lessThanOrEqual(20)))
      .nest(Address::getCity, "city",
            b -&gt; b.constraint(City::getName, "name", c -&gt; c.notBlank().lessThanOrEqual(100)))
      .build();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_violation_messages">Overriding violation messages</h3>
<div class="paragraph">
<p>The default violation message for each constraint is defined in <a href="#built-in-constraints">[built-in-constraints]</a>.</p>
</div>
<div class="paragraph">
<p>If you want to customize the violation message, append <code>message</code> method on the target constraint as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;User&gt; validator = ValidatorBuilder.&lt;User&gt; of()
    .constraint(User::getName, "name", c -&gt; c.notNull().message("name is required!")
        .greaterThanOrEqual(1).message("name is too small!")
        .lessThanOrEqual(20).message("name is too large!"))
    .build()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_custom_constraint">Creating a custom constraint</h3>
<div class="paragraph">
<p>If you want to apply constraints that are not in the <a href="#built-in-constraints">[built-in-constraints]</a>, you can create custom constraints by implementing <code>am.ik.yavi.core.CustomConstraint</code> interface as bellow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class IsbnConstraint implements CustomConstraint&lt;String&gt; {

    @Override
    public boolean test(String s) {
    	// Delegate processing to another method
        return ISBNValidator.isISBN13(s);
    }

    @Override
    public String messageKey() {
        return "string.isbn13";
    }

    @Override
    public String defaultMessageFormat() {
        return "\"{0}\" must be ISBN13 format";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The created custom constraint can be specified by <code>predicate</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">IsbnConstraint isbn = new IsbnConstraint();
Validator&lt;Book&gt; book = ValidatorBuilder.&lt;Book&gt; of()
    .constraint(Book::getTitle, "title", c -&gt; c.notBlank().lessThanOrEqual(64))
    .constraint(Book::getIsbn, "isbn", c -&gt; c.notBlank().predicate(isbn))
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also write constraint rules directly in the <code>predicate</code> method instead of defining the <code>CustomConstraint</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validator&lt;Book&gt; book = ValidatorBuilder.&lt;Book&gt; of()
    .constraint(Book::getTitle, "title", c -&gt; c.notBlank().lessThanOrEqual(64))
    .constraint(Book::getIsbn, "isbn", c -&gt; c.notBlank().predicate(s -&gt; ISBNValidator.isISBN13(s), ViolationMessage.of("string.isbn13", "\"{0}\" must be ISBN13 format")))
    .build();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin_support">Kotlin Support</h3>
<div class="paragraph">
<p>If you are using Kotlin, you can define a <code>Validator</code> a bit shorter than Java using <code>konstraint</code> method instead of <code>constraint</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">val validator: Validator&lt;User&gt; = ValidatorBuilder.of&lt;User&gt;()
    .konstraint(User::name) {
        notNull()
            .lessThanOrEqual(20)
    }
    .konstraint(User::email) {
        notNull()
            .greaterThanOrEqual(5)
            .lessThanOrEqual(50)
            .email()
    }
    .konstraint(User::age) {
        notNull()
            .greaterThanOrEqual(0)
            .lessThanOrEqual(200)
    }
    .build()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>konstraint</code> actually uses <code>kotlin.reflect.KProperty1</code> ðŸ¤«
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-06-14 16:12:09 UTC
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>