<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Combining validators</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="combining-validators">Combining validators</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>ApplicativeValidator&lt;T&gt;</code> and <code>Arguments1Validator&lt;S, T&gt;</code> we&#8217;ve seen so far extend <code>ValueValidator&lt;S, T&gt;</code>.
(<code>T</code> is the type of the target object to be validated and <code>S</code> is the type of the source object to create the target object.)</p>
</div>
<div class="paragraph">
<p><code>ApplicativeValidator&lt;T&gt;</code> is a <code>ValueValidator&lt;T, T&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Multiple <code>ValueValidator</code> s can be combined to validate a larger object.</p>
</div>
<div class="sect2">
<h3 id="_splitting_a_validator_for_an_object_into_small_pieces">Splitting a validator for an object into small pieces</h3>
<div class="paragraph">
<p>You can use <code>split</code> method to split a validator for the arguments of a constructor or a factory method for creating a large object into small validators and combine them.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at an example.</p>
</div>
<div class="paragraph">
<p>Validator for constructor <code>Person(String, String, Integer)</code> is <code>Arguments3Validator&lt;String, String, Integer, Person&gt;</code>.
This can be divided into two <code>StringValidator&lt;String&gt;</code> s and one <code>IntegerValidator&lt;Integer&gt;</code> and then combined.</p>
</div>
<div class="paragraph">
<p>It can be defined as bellow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {
    public Person(String name, String email, Integer age) {
        // ...
    }
}

StringValidator&lt;String&gt; nameValidator = /* see examples above */;
StringValidator&lt;String&gt; emailValidator = /* see examples above */;
IntegerValidator&lt;Integer&gt; ageValidator = /* see examples above */;

Arguments3Validator&lt;String, String, Integer, Person&gt; personValidator = ArgumentsValidators
    .split(nameValidator, emailValidator, ageValidator)
    .apply(Person::new);
// or
Arguments3Validator&lt;String, String, Integer, Person&gt; personValidator = nameValidator
    .split(emailValidator)
    .split(ageValidator)
    .apply(Person::new);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same goes for Validators for Value Objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {
    public Person(Name name, Email email, Age age) {
        // ...
    }
}

StringValidator&lt;Name&gt; nameValidator = /* see examples above */;
StringValidator&lt;Email&gt; emailValidator = /* see examples above */;
IntegerValidator&lt;Age&gt; ageValidator = /* see examples above */;

Arguments3Validator&lt;String, String, Integer, Person&gt; personValidator = ArgumentsValidators
    .split(nameValidator, emailValidator, ageValidator)
    .apply(Person::new);
// or
Arguments3Validator&lt;String, String, Integer, Person&gt; personValidator = nameValidator
    .split(emailValidator)
    .split(ageValidator)
    .apply(Person::new);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The created Validator can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Validated&lt;Person&gt; personValidated = Person.validator.validate("Jone Doe", "jdoe@example.com", 30);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the arguments of <code>ArgumentsValidators#split</code> are <code>ValueValidator</code> s rather than <code>Arguments1Validator</code> s, you can also combine <code>ApplicativeValidator</code> s as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ApplicativeValidator&lt;Email&gt; emailValidator = /* see examples above */;
ApplicativeValidator&lt;PhoneNumber&gt; phoneNumberValidator = /* see examples above */;

Arguments2Validator&lt;Email, PhoneNumber, ContactInfo&gt; contactInfoValidator = ArgumentsValidators
    .split(emailValidator, phoneNumberValidator)
    .apply(ContactInfo::new);

Validated&lt;ContactInfo&gt; contactInfoValidated = contactInfoValidator.validate(new Email("yavi@example.com"), new PhoneNumber("090-123-4567"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validating_the_source_object_before_creating_the_target_object">Validating the source object before creating the target object</h3>
<div class="paragraph">
<p>In a web application, you often get values from a <code>Map</code>, Form Object, or <code>HttpServletRequest</code> to create a Domain Object.</p>
</div>
<div class="paragraph">
<p><code>Arguments1Validator</code> can validate the source object and then convert it to the target object using <code>compose</code> method.</p>
</div>
<div class="paragraph">
<p>For example, in the case where <code>name</code>, <code>email</code> and <code>age</code> are obtained from <code>HttpServletRequest</code> object as HTTP request parameters in Servlet, it can be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Argument1Validator&lt;HttpServletRequest, Name&gt; requestNameValidator = nameValidator
    .compose(req -&gt; req.getParameter("name"));
Argument1Validator&lt;HttpServletRequest, Email&gt; requestEmailValidator = emailValidator
    .compose(req -&gt; req.getParameter("email"));
Argument1Validator&lt;HttpServletRequest, Age&gt; requestAgeValidator = ageValidator
    .compose(req -&gt; Integer.valueOf(req.getParameter("age")));

HttpServletRequest request = ...;
Validated&lt;Name&gt; nameValidated = requestNameValidator.validate(request);
Validated&lt;Email&gt; emailValidated = requestEmailValidator.validate(request);
Validated&lt;Age&gt; ageValidated = requestAgeValidator.validate(request);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can combine these Validators with <code>combine</code> method as follows to create a Validator for <code>Person</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments1Validator&lt;HttpServletRequest, Person&gt; requestPersonValidator = ArgumentsValidators
    .combine(requestNameValidator, requestEmailValidator, requestAgeValidator)
    .apply(Person::new);
// or
Arguments1Validator&lt;HttpServletRequest, Person&gt; requestPersonValidator = requestNameValidator
    .combine(requestEmailValidator)
    .combine(requestAgeValidator)
    .apply(Person::new);

HttpServletRequest request = ...;
Validated&lt;Person&gt; personValidated = requestPersonValidator.validate(request);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Validator can also be converted from <code>Arguments3Validator&lt;String, String, Integer, Person&gt;</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Arguments3Validator&lt;String, String, Integer, Person&gt; personValidator = /* see examples above */;
Arguments1Validator&lt;HttpServletRequest, Person&gt; requestPersonValidator = personValidator
    .compose(req -&gt; Arguments.of(req.getParameter("name"), req.getParameter("email"), Integer.valueOf(req.getParameter("age"))));</code></pre>
</div>
</div>
<div class="paragraph">
<p>By combining Validators in this way, you can create various patterns of Validators. Creating a small Arguments Validator not only allows you to validate the values before creating the object, but also makes it more reusable.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-10-14 16:21:38 UTC
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>